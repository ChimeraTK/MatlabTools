#!/bin/bash

#drop out in case of an error
set -e

#determine the libmtca4u-deviceaccess the mex is linked with, incl. version
MAPPED_DEVICE_LIB=`ldd mtca4u-matlab-tools/local/lib/mtca4u_mex.@MTCA4U_MATLAB_VERSION@.mexa64\
     | grep "libmtca4u-deviceaccess.so" | sed "{s|^.*=> ||}" | sed "{s| (.*$||}"`

#get the package name which provides the MAPPED_DEVICE_LIB\
#The command is split in two to see the error status of the dpkg command.
#This script should stop with an error of dpkg cannot fulfill it's dependencies
DPKG_SEARCH_RESULT=`dpkg -S ${MAPPED_DEVICE_LIB}`
MAPPED_DEVICE_PACKAGE=`echo ${DPKG_SEARCH_RESULT} | sed "{s|:.*$||}"`

#add the dependency to the substvars file
echo mex:Depends=${MAPPED_DEVICE_PACKAGE} >> mtca4u-matlab-tools.substvars 
